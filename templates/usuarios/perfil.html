{% extends 'base.html' %}

{% block title %}Meu Perfil - Farm√°cia QUEOPS{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>üë§ Meu Perfil</h1>
        <p>Bem-vindo, {{ user.username }}!</p>
    </div>
</div>

<div class="container" style="margin-top: 2rem;">
    <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem;">
        <!-- Sidebar com informa√ß√µes do usu√°rio -->
        <aside>
            <div class="card">
                <div class="card-body">
                    <h2 style="color: var(--verde-principal); margin-bottom: 1rem; font-size: 1.5rem;">
                        Informa√ß√µes da Conta
                    </h2>
                    <p><strong>Usu√°rio:</strong> {{ user.username }}</p>
                    <p><strong>Email:</strong> {{ user.email|default:"N√£o informado" }}</p>
                    <p><strong>Nome:</strong> {{ user.get_full_name|default:"N√£o informado" }}</p>
                    <p><strong>Membro desde:</strong> {{ user.date_joined|date:"d/m/Y" }}</p>
                    
                    <hr style="margin: 1.5rem 0;">
                    
                    <a href="{% url 'usuarios:logout' %}" class="btn btn-danger btn-block">
                        Sair da Conta
                    </a>
                </div>
            </div>
        </aside>

        <!-- Hist√≥rico de Pedidos -->
        <div>
            <h2 style="color: var(--verde-principal); margin-bottom: 1.5rem;">
                üì¶ Hist√≥rico de Pedidos
            </h2>

            {% if pedidos %}
                {% for pedido in pedidos %}
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="card-body">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="color: var(--verde-principal); font-size: 1.25rem;">
                                Pedido #{{ pedido.id }}
                            </h3>
                            <span style="
                                padding: 0.5rem 1rem; 
                                border-radius: 5px; 
                                font-weight: bold;
                                {% if pedido.status == 'entregue' %}
                                    background-color: #28a745; color: white;
                                {% elif pedido.status == 'cancelado' %}
                                    background-color: #dc3545; color: white;
                                {% elif pedido.status == 'enviado' %}
                                    background-color: #17a2b8; color: white;
                                {% else %}
                                    background-color: #ffc107; color: black;
                                {% endif %}
                            ">
                                {{ pedido.get_status_display }}
                            </span>
                        </div>

                        <p><strong>Data:</strong> {{ pedido.criado_em|date:"d/m/Y H:i" }}</p>
                        <p><strong>Subtotal:</strong> R$ {{ pedido.total }}</p>
                        <p><strong>Frete:</strong> R$ {{ pedido.valor_frete }}</p>
                        <p><strong>Total Geral:</strong> <span style="color: var(--verde-principal); font-weight: bold;">R$ {{ pedido.total_com_frete }}</span></p>
                        <p><strong>Endere√ßo:</strong> {{ pedido.endereco }}, {{ pedido.cidade }}/{{ pedido.estado }}</p>

                        <hr style="margin: 1rem 0;">

                        <h4 style="margin-bottom: 0.5rem;">Itens do Pedido:</h4>
                        <ul style="list-style: none; padding: 0;">
                            {% for item in pedido.itens.all %}
                                <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--cinza-medio);">
                                    <strong>{{ item.quantidade }}x</strong> {{ item.produto.nome }} 
                                    - R$ {{ item.preco_unitario }} cada
                                    <span style="float: right; font-weight: bold; color: var(--verde-principal);">
                                        R$ {{ item.subtotal }}
                                    </span>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-cart">
                    <h3>Voc√™ ainda n√£o fez nenhum pedido</h3>
                    <p>Explore nossos produtos e fa√ßa seu primeiro pedido!</p>
                    <a href="{% url 'produtos:lista' %}" class="btn btn-primary">
                        Ver Produtos
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
